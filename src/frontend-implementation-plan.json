{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Settings dialog for viewing and copying user principals",
  "requirements": [
    {
      "id": "REQ-38",
      "summary": "Add a Settings entry point in the authenticated chat header that opens a non-navigating Settings dialog/panel.",
      "acceptanceCriteria": [
        "When signed in and viewing the main chat layout, a user can open a Settings view from the header.",
        "Opening/closing the Settings view does not break the existing mobile thread-list/thread-view navigation behavior.",
        "All user-facing labels in the Settings UI are in English."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/chat/ChatLayout.tsx",
          "operation": "modify",
          "description": "Add a Settings button in the header and wire it to open/close a Settings view rendered as an in-place dialog/panel so it does not navigate away from chat; ensure it does not interfere with existing mobile list/thread conditional rendering. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/settings/SettingsDialog.tsx",
          "operation": "create",
          "description": "Implement a Settings dialog/panel component composed from existing shadcn/ui components (do not edit any files under frontend/src/components/ui) that can be controlled via open/onOpenChange props and renders English labels. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-39",
      "summary": "Show the current user’s full Internet Identity principal in Settings with copy-to-clipboard and clear success/failure feedback.",
      "acceptanceCriteria": [
        "The Settings view shows the current user’s full principal (not truncated).",
        "Clicking the copy button copies the principal to the clipboard.",
        "On success, the app shows an English confirmation (e.g., toast) indicating the principal was copied.",
        "If clipboard copy fails, the app shows an English error message."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/settings/SettingsDialog.tsx",
          "operation": "modify",
          "description": "Display the signed-in user's full principal string (not truncated) using existing identity/current-principal access (without modifying immutable hooks) and add a copy button that triggers clipboard copy with English success/error feedback (use existing toast system). Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/utils/clipboard.ts",
          "operation": "create",
          "description": "Add a small utility to perform clipboard copy with robust error handling (e.g., navigator.clipboard when available, with clear thrown errors) so Settings can show consistent success/failure messaging. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-40",
      "summary": "List users in Settings with display name (when available), full principal, and per-user copy buttons, using admin vs non-admin user discovery rules.",
      "acceptanceCriteria": [
        "If the signed-in user is an admin, populate the list using the existing admin user listing hook (useGetAllUsers() from frontend/src/hooks/useUsers.ts).",
        "If the signed-in user is not an admin, populate the list using the existing authorized-user discovery hook (useGetChatUsers() from frontend/src/hooks/useUsers.ts).",
        "Each row shows a full principal (not truncated) and a copy button.",
        "Clicking a row’s copy button copies the correct principal to the clipboard and shows English success/failure feedback.",
        "The current user is not duplicated in the non-admin list (do not list the caller as a target user)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/settings/SettingsDialog.tsx",
          "operation": "modify",
          "description": "Add a users list section: if admin, use useGetAllUsers(); otherwise, use useGetChatUsers(); render each row with display name (when available) and full principal (not truncated) plus a copy button per row that uses the clipboard utility and shows English success/error feedback. For non-admin, filter out the current user principal to avoid listing the caller. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}